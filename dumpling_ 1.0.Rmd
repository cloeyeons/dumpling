---
title: "최고의 냉동만두를 찾아서"
date: "2025-02-16"
output:
  pdf_document:
    latex_engine: xelatex
fontsize: 10pt
mainfont: NanumGothic
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(error = TRUE, echo = TRUE, warning = FALSE, message = FALSE)
set.seed(0)
```

```{r}
library(tidyverse)
library(tidymodels)
library(showtext)
library(kableExtra)

showtext_auto()

font_add_google("Nanum Gothic", "NanumGothic")
dumpling <- read.csv("https://raw.githubusercontent.com/cloeyeons/dumpling/refs/heads/main/dumpling_data.csv", fileEncoding = "UTF-8")
```

# 1. 기본 분포도 및 주요 정보 조사

## 1-1. 점유율

```{r}
brand_count <- dumpling %>%
  count(comp) %>%
  arrange(desc(n)) %>%
  rename(frequency = n)

ggplot(brand_count, aes(x = "", y = frequency, fill = comp)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar(theta = "y") +
  labs(title = "제조사별 냉동만두 점유율",
       fill = "제조사") +
  theme_void() +
  theme(text = element_text(family = "NanumGothic"))
```
오뚜기 사의 만두 5종이 누적 냉동만두 판매량 상위 30위에 랭크되며 약 17%로 가장 높은 점유율을 보여주었습니다. 

## 1-2. 100g 당 가격 분포
```{r}
ggplot(dumpling, aes(x = price)) +
  geom_histogram(binwidth = 200, fill = "green") +
  labs (x = "가격 (원)", 
        y = "상품 수",
        title = "100g 당 가격") + 
  scale_x_continuous(breaks = seq(600, max(dumpling$price), by = 400))  +
  scale_y_continuous(breaks = seq(0, 30, by = 2)) + 
  theme(text = element_text(family = "NanumGothic"))
```

## 1-3. 100g 당 칼로리 분포
```{r}
ggplot(dumpling, aes(x = calories)) +
  geom_histogram(binwidth = 20, fill = "orange") +
  labs (x = "칼로리 (kcal)",
        y = "상품 수",
        title = "100g 당 칼로리") + 
  scale_x_continuous(breaks = seq(0, max(dumpling$calories), by = 40)) + 
  scale_y_continuous(breaks = seq(0, 30, by = 2)) + 
  theme(text = element_text(family = "NanumGothic"))
```

## 1-4. 돼지고기 함유량
```{r}
ggplot(dumpling, aes(x = porkCont)) +
  geom_histogram(binwidth = 2, fill = "blue") +
  labs (x = "함유량 (%)", 
        y = "제품 수",
        title = "돼지고기 함유량 (%)") + 
  scale_x_continuous(breaks = seq(0, max(dumpling$porkCont), by = 6)) + 
   scale_y_continuous(breaks = seq(0, 30, by = 2)) + 
  theme(text = element_text(family = "NanumGothic"))
```
  
# 2. 연관성 조사
## 2-1. 돼지고기 함유량 vs. 가격
```{r}
ggplot(dumpling, aes(x = porkCont, y = price)) + 
  geom_point(color = "black", size = 3) + 
  geom_smooth(method = "lm", color = "red") +  
  labs (x = "돼지고기 함유량 (%)", 
        y = "가격 (원)", 
        title = "돼지고기 함유량 vs. 가격") +
  theme(text = element_text(family = "NanumGothic"))

pp_corr <- cor.test(dumpling$porkCont, dumpling$price)
print(pp_corr)
```

## 2-2. 돼지고기 함유량, 가격 vs. 소비자 별점
```{r}
cleaned_data <- dumpling[complete.cases(dumpling$porkCont, dumpling$rating),] 

ggplot(cleaned_data, aes(x = porkCont, y = rating)) + 
  geom_point(color = "black", size = 3) + 
  geom_smooth(method = "lm", color = "red") +  
  labs (x = "돼지고기 함유량",
        y = "소비자 별점",
        title = "돼지고기 함유량 vs. 소비자 별점") +
  theme(text = element_text(family = "NanumGothic"))
  
pr_corr <- cor.test(cleaned_data$porkCont, cleaned_data$rating)
print(pr_corr)

ggplot(cleaned_data, aes(x = price, y = rating)) + 
  geom_point(color = "black", size = 3) + 
  geom_smooth(method = "lm", color = "blue") +  
  labs (x = "가격",
        y = "소비자 별점",
        title = "가격 vs. 소비자 별점") +
  theme(text = element_text(family = "NanumGothic"))
  
pr_corr <- cor.test(cleaned_data$porkCont, cleaned_data$rating)
print(pr_corr)
```

```{r}
interaction_model <- lm(rating ~ price * porkCont, data = cleaned_data)
summary(interaction_model)
```

# 3. 종합 순위
```{r}
dumpling_rank <- dumpling %>%
  mutate(
    sales_rank = rank(rank, ties.method = "first"), 
    price_rank = rank(price, ties.method = "first"),  
    calories_rank = rank(calories, ties.method = "first"), 
    pork_content_rank = rank(-porkCont, ties.method = "first"))

ranked_summary <- dumpling_rank %>%
  select(comp,
         product,
         sales_rank, 
         price_rank, 
         calories_rank, 
         pork_content_rank)

ranked_summary <- ranked_summary %>%
  mutate(overall_rank_raw = rowSums(select(., sales_rank, price_rank, calories_rank, pork_content_rank))) %>%
  mutate(overall_rank = rank(overall_rank_raw, ties.method = "first")) %>%
  arrange(overall_rank)

ranking_table <- ranked_summary %>%
  select(overall_rank, comp, product, sales_rank, price_rank, calories_rank, pork_content_rank) %>%
  mutate(
    comp = stringr::str_wrap(comp, width = 20),
    product = stringr::str_wrap(product, width = 30)
  )

knitr::kable(ranking_table,
             format = "latex",
             booktabs = TRUE,
             caption = "종합 순위표",
             col.names = c("종합 순위", "제조사", "제품명", "판매순위", "가격순위", "칼로리순위 (낮은 순)", "돼지고기함유량순위"),
             align = c("c", "l", "l", "c", "c", "c", "c"),
             escape = TRUE) %>%
  kable_styling(latex_options = c("hold_position", "scale_down"),
                font_size = 9)
```
 
